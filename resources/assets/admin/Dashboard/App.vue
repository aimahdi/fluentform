<template>
    <div>
        <div class="ff_dashboard">

            <el-card class="dashboard-card" :body-style="{ padding: '0px' }">
                <div style="padding: 14px;">
                    <div class="css-1j5s3cl">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                             aria-hidden="true" role="img" class="MuiBox-root css-1m01c8l iconify iconify--ant-design"
                             width="1em" height="1em" viewBox="0 0 1024 1024">
                            <path fill="#3f9eff"
                                  d="M270.1 741.7c0 23.4 19.1 42.5 42.6 42.5h48.7v120.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V784.1h85v120.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V784.1h48.7c23.5 0 42.6-19.1 42.6-42.5V346.4h-486v395.3zm357.1-600.1l44.9-65c2.6-3.8 2-8.9-1.5-11.4c-3.5-2.4-8.5-1.2-11.1 2.6l-46.6 67.6c-30.7-12.1-64.9-18.8-100.8-18.8c-35.9 0-70.1 6.7-100.8 18.8l-46.6-67.5c-2.6-3.8-7.6-5.1-11.1-2.6c-3.5 2.4-4.1 7.4-1.5 11.4l44.9 65c-71.4 33.2-121.4 96.1-127.8 169.6h486c-6.6-73.6-56.7-136.5-128-169.7zM409.5 244.1a26.9 26.9 0 1 1 26.9-26.9a26.97 26.97 0 0 1-26.9 26.9zm208.4 0a26.9 26.9 0 1 1 26.9-26.9a26.97 26.97 0 0 1-26.9 26.9zm223.4 100.7c-30.2 0-54.6 24.8-54.6 55.4v216.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V400.1c.1-30.6-24.3-55.3-54.6-55.3zm-658.6 0c-30.2 0-54.6 24.8-54.6 55.4v216.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V400.1c0-30.6-24.5-55.3-54.6-55.3z"></path>
                        </svg>
                    </div>
                    <div class="dashboard-card-header">
                        <h3> 2.3k</h3>
                    </div>

                    <div class="dashboard-card-text">
                        <div class="time"><h6>Welcome Form</h6></div>
                        <el-button size="small"> Most Form Submissions</el-button>
                    </div>

                </div>
            </el-card>
            <el-card class="dashboard-card" :body-style="{ padding: '0px' }">
                <div style="padding: 14px;">
                    <div class="css-1j5s3cl">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                             aria-hidden="true" role="img" class="MuiBox-root css-1m01c8l iconify iconify--ant-design"
                             width="1em" height="1em" viewBox="0 0 1024 1024">
                            <path fill="#3f9eff"
                                  d="M270.1 741.7c0 23.4 19.1 42.5 42.6 42.5h48.7v120.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V784.1h85v120.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V784.1h48.7c23.5 0 42.6-19.1 42.6-42.5V346.4h-486v395.3zm357.1-600.1l44.9-65c2.6-3.8 2-8.9-1.5-11.4c-3.5-2.4-8.5-1.2-11.1 2.6l-46.6 67.6c-30.7-12.1-64.9-18.8-100.8-18.8c-35.9 0-70.1 6.7-100.8 18.8l-46.6-67.5c-2.6-3.8-7.6-5.1-11.1-2.6c-3.5 2.4-4.1 7.4-1.5 11.4l44.9 65c-71.4 33.2-121.4 96.1-127.8 169.6h486c-6.6-73.6-56.7-136.5-128-169.7zM409.5 244.1a26.9 26.9 0 1 1 26.9-26.9a26.97 26.97 0 0 1-26.9 26.9zm208.4 0a26.9 26.9 0 1 1 26.9-26.9a26.97 26.97 0 0 1-26.9 26.9zm223.4 100.7c-30.2 0-54.6 24.8-54.6 55.4v216.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V400.1c.1-30.6-24.3-55.3-54.6-55.3zm-658.6 0c-30.2 0-54.6 24.8-54.6 55.4v216.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V400.1c0-30.6-24.5-55.3-54.6-55.3z"></path>
                        </svg>
                    </div>
                    <div class="dashboard-card-header"><h3>2.1k</h3>
                    </div>

                    <div class="dashboard-card-text">
                        <div class="time"><h6>Contact</h6></div>

                        <el-button size="small"> Most Viewed Form</el-button>

                    </div>

                </div>
            </el-card>

            <el-card class="dashboard-card" :body-style="{ padding: '0px' }">
                <div style="padding: 14px;">
                    <div class="css-1j5s3cl">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                             aria-hidden="true" role="img" class="MuiBox-root css-1m01c8l iconify iconify--ant-design"
                             width="1em" height="1em" viewBox="0 0 1024 1024">
                            <path fill="#3f9eff"
                                  d="M270.1 741.7c0 23.4 19.1 42.5 42.6 42.5h48.7v120.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V784.1h85v120.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V784.1h48.7c23.5 0 42.6-19.1 42.6-42.5V346.4h-486v395.3zm357.1-600.1l44.9-65c2.6-3.8 2-8.9-1.5-11.4c-3.5-2.4-8.5-1.2-11.1 2.6l-46.6 67.6c-30.7-12.1-64.9-18.8-100.8-18.8c-35.9 0-70.1 6.7-100.8 18.8l-46.6-67.5c-2.6-3.8-7.6-5.1-11.1-2.6c-3.5 2.4-4.1 7.4-1.5 11.4l44.9 65c-71.4 33.2-121.4 96.1-127.8 169.6h486c-6.6-73.6-56.7-136.5-128-169.7zM409.5 244.1a26.9 26.9 0 1 1 26.9-26.9a26.97 26.97 0 0 1-26.9 26.9zm208.4 0a26.9 26.9 0 1 1 26.9-26.9a26.97 26.97 0 0 1-26.9 26.9zm223.4 100.7c-30.2 0-54.6 24.8-54.6 55.4v216.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V400.1c.1-30.6-24.3-55.3-54.6-55.3zm-658.6 0c-30.2 0-54.6 24.8-54.6 55.4v216.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V400.1c0-30.6-24.5-55.3-54.6-55.3z"></path>
                        </svg>
                    </div>
                    <div class="dashboard-card-header"><h3>714k</h3>
                    </div>

                    <div class="dashboard-card-text">

                        <div class="time"><h6>Form Name</h6></div>
                        <el-button size="small"> Most Converted</el-button>

                    </div>

                </div>
            </el-card>



        </div>
        <div class="ff_dashboard">
            <el-card class="dashboard-card dashboard-graph" :body-style="{ padding: '0px' }">
                <div style="padding: 14px;">
                    <div class="dashboard-card-header">
                        {{ $t('Submission Stats') }}
                        <el-date-picker
                                v-model="date_range"
                                size="mini"
                                value-format="yyyy-MM-dd"
                                type="daterange"
                                :picker-options="pickerOptions"
                                range-separator="To"
                                :start-placeholder="$t('Start date')"
                                :end-placeholder="$t('End date')">
                        </el-date-picker>
                    </div>
                    <div class="dashboard-cart-text">
                        <subscriber-chart  :styles="myStyles"  :chart-data="chartData" :maxCumulativeValue="0"></subscriber-chart>

                    </div>
                </div>
            </el-card>
            <el-card class="dashboard-card" :body-style="{ padding: '0px' }">
                <div style="padding: 14px;">
                    <div class="css-1j5s3cl">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                             aria-hidden="true" role="img" class="MuiBox-root css-1m01c8l iconify iconify--ant-design"
                             width="1em" height="1em" viewBox="0 0 1024 1024">
                            <path fill="#3f9eff"
                                  d="M270.1 741.7c0 23.4 19.1 42.5 42.6 42.5h48.7v120.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V784.1h85v120.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V784.1h48.7c23.5 0 42.6-19.1 42.6-42.5V346.4h-486v395.3zm357.1-600.1l44.9-65c2.6-3.8 2-8.9-1.5-11.4c-3.5-2.4-8.5-1.2-11.1 2.6l-46.6 67.6c-30.7-12.1-64.9-18.8-100.8-18.8c-35.9 0-70.1 6.7-100.8 18.8l-46.6-67.5c-2.6-3.8-7.6-5.1-11.1-2.6c-3.5 2.4-4.1 7.4-1.5 11.4l44.9 65c-71.4 33.2-121.4 96.1-127.8 169.6h486c-6.6-73.6-56.7-136.5-128-169.7zM409.5 244.1a26.9 26.9 0 1 1 26.9-26.9a26.97 26.97 0 0 1-26.9 26.9zm208.4 0a26.9 26.9 0 1 1 26.9-26.9a26.97 26.97 0 0 1-26.9 26.9zm223.4 100.7c-30.2 0-54.6 24.8-54.6 55.4v216.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V400.1c.1-30.6-24.3-55.3-54.6-55.3zm-658.6 0c-30.2 0-54.6 24.8-54.6 55.4v216.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V400.1c0-30.6-24.5-55.3-54.6-55.3z"></path>
                        </svg>
                    </div>
                    <div class="dashboard-card-header"><h3>714k</h3>
                    </div>

                    <div class="dashboard-card-text">

                        <div class="time"><h6>Form Name</h6></div>
                        <el-button size="small"> Most Converted</el-button>

                    </div>

                </div>
            </el-card>
        </div>
    </div>
</template>
<script type="text/babel">
    import VisualReports from '../views/Reports/VisualReports.vue';
    import EntriesChart from './../AllEntries/Components/chartView';

    import SubscriberChart from '../AllEntries/Components/_chart'
    import each from 'lodash/each';


    export default {
        name: 'Dashboard',
        components: {SubscriberChart},
        data() {
            return {
                currentDate: new Date(),
                date_range: ['', ''],
                pickerOptions: {
                    shortcuts: [
                        {
                            text: 'Last week',
                            onClick(picker) {
                                const end = new Date();
                                const start = new Date();
                                start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
                                picker.$emit('pick', [start, end]);
                            }
                        }, {
                            text: 'Last month',
                            onClick(picker) {
                                const end = new Date();
                                const start = new Date();
                                start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
                                picker.$emit('pick', [start, end]);
                            }
                        }, {
                            text: 'Last 3 months',
                            onClick(picker) {
                                const end = new Date();
                                const start = new Date();
                                start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);
                                picker.$emit('pick', [start, end]);
                            }
                        }],
                    disabledDate(date) {
                        return date.getTime() >= Date.now();
                    }
                },
                chartData: {},

            }
        },
        computed: {
            myStyles () {
                return {
                    height: '200px',
                    position: 'relative'
                }
            }
        },
        methods: {
            fetchData() {
                this.loading = true;
                FluentFormsGlobal.$get({
                    action: 'fluentform_get_all_entries_report',
                    form_id: this.form_id,
                    date_range: this.date_range
                })
                    .then(response => {
                        this.stats = response.data.stats;
                        this.setupChartItems();
                    })
                    .fail(error => {
                        console.log(error);
                    })
                    .always(() => {
                        this.loading = false;
                        this.show_stats = true;
                    });
            },
            setupChartItems() {
                const labels = [];
                const ItemValues = {
                    label: 'Submission Count',
                    yAxisID: 'byDate',
                    backgroundColor: 'rgba(81, 52, 178, 0.5)',
                    borderColor: '#b175eb',
                    data: [],
                    fill: false,
                    gridLines: {
                        display: false
                    }
                };

                let currentTotal = 0;
                each(this.stats, (count, label) => {
                    ItemValues.data.push(count);
                    labels.push(label);
                    currentTotal += parseInt(count);
                });
                this.maxCumulativeValue = currentTotal + 10;
                this.chartData = {
                    labels: labels,
                    datasets: [ItemValues]
                }
            }
        },
        mounted() {
            this.fetchData();

        }
    };
</script>
<style>
    .ff_dashboard {
        display: flex;
        flex-direction: row;
        gap: 50px;
        margin-bottom: 20px;

    }

    .dashboard-card {
        transition: box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
        background-image: none;
        overflow: hidden;
        border-radius: 10px;
        position: relative;
        padding-top: 15px;
        padding-bottom: 15px;
        box-shadow: none;
        text-align: center;
        background: white;
        flex-grow: 1;
        color: rgb(6, 27, 100);
    }

    .css-1j5s3cl {
        margin: auto auto 24px;
        display: flex;
        border-radius: 50%;
        -webkit-box-align: center;
        align-items: center;
        width: 64px;
        height: 64px;
        -webkit-box-pack: center;
        justify-content: center;
        color: rgb(16, 57, 150);
        border: 1px solid #3f9eff;
        background: #eef8ff;

    }

    .css-1m01c8l {
        height: 24px;
        width: 24px;
    }

    .dashboard-card-header h3 {
        margin: 0px;
        font-weight: 600;
        line-height: 1.5;
        font-size: 1.8em;
    }

    .dashboard-card-text h6 {
        margin: 0px;
        font-weight: 400;
        line-height: 1.5;
        font-size: 1.2em;
    }

    .dashboard-card-text {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;

    }

    .dashboard-card-text .el-button {
        width: auto;
    }
    .dashboard-graph{
        flex: 4;
    }
</style>



